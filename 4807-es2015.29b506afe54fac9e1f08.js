"use strict";(self.webpackChunkhotely=self.webpackChunkhotely||[]).push([[4807],{14807:function(e,t,i){i.r(t),i.d(t,{OrderPageModule:function(){return _}});var r=i(12057),n=i(24751),o=i(33982),s=i(17936),l=i(73498),c=i(88002),a=i(74788);function d(e,t){if(1&e&&(a.TgZ(0,"ion-radio-group",2),a.TgZ(1,"ion-list-header"),a.TgZ(2,"ion-label"),a._uU(3,"Type de la commande"),a.qZA(),a.qZA(),a.TgZ(4,"ion-item"),a.TgZ(5,"ion-label"),a._uU(6,"\xc0 emporter"),a.qZA(),a._UZ(7,"ion-radio",3),a.qZA(),a.TgZ(8,"ion-item"),a.TgZ(9,"ion-label"),a._uU(10,"Sur place"),a.qZA(),a._UZ(11,"ion-radio",4),a.qZA(),a.qZA()),2&e){const e=a.oxw();a.Q6J("value",null==e.order?null:e.order.type)("formControl",e.orderTypeControl)}}function u(e,t){1&e&&(a.TgZ(0,"ion-label"),a._uU(1," Commande sur place "),a.qZA())}function b(e,t){1&e&&(a.TgZ(0,"ion-label"),a._uU(1," Commande \xe0 emporter "),a.qZA())}function h(e,t){if(1&e&&(a.TgZ(0,"ion-item"),a.YNc(1,u,2,0,"ion-label",5),a.YNc(2,b,2,0,"ion-label",5),a.qZA()),2&e){const e=a.oxw();a.xp6(1),a.Q6J("ngIf","ON_SITE"===(null==e.order?null:e.order.type)),a.xp6(1),a.Q6J("ngIf","TAKE_AWAY"===(null==e.order?null:e.order.type))}}let g=(()=>{class e{constructor(){this.typeSelected=new a.vpe,this.orderTypeControl=new n.NI,this.orderTypeSubscription=this.orderTypeControl.valueChanges.subscribe(e=>{this.readOnly||this.typeSelected.emit(e)})}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=a.Xpm({type:e,selectors:[["mobile-order-type-select"]],inputs:{order:"order",readOnly:"readOnly"},outputs:{typeSelected:"typeSelected"},decls:3,vars:2,consts:[[3,"value","formControl",4,"ngIf","ngIfElse"],["readOnlyOrderType",""],[3,"value","formControl"],["slot","start","value","TAKE_AWAY"],["slot","start","value","ON_SITE"],[4,"ngIf"]],template:function(e,t){if(1&e&&(a.YNc(0,d,12,2,"ion-radio-group",0),a.YNc(1,h,3,2,"ng-template",null,1,a.W1O)),2&e){const e=a.MAs(2);a.Q6J("ngIf",!t.readOnly)("ngIfElse",e)}},directives:[r.O5,l.se,l.QI,n.JJ,n.oH,l.yh,l.Q$,l.Ie,l.B7,l.U5],styles:[""]}),e})();function p(e,t){if(1&e&&(a.TgZ(0,"ion-select-option",2),a._uU(1),a.qZA()),2&e){const e=t.$implicit;a.Q6J("value",e.id)("disabled",!e.available),a.xp6(1),a.hij(" ",e.name," ")}}let f=(()=>{class e{constructor(){this.tableSelect=new a.vpe,this.tableSelectControl=new n.NI}set disabled(e){e&&this.tableSelectControl.disable()}set tables(e){e&&(this._tables=e,this.tableSelectControl.setValue(this.order.table),this.selectedTable=e.find(e=>e.id===this.order.table),this.tableSelected({detail:{value:this.order.table}}))}ngOnInit(){}tableSelected(e){this.tableSelect.emit(e.detail.value)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=a.Xpm({type:e,selectors:[["mobile-table-select"]],inputs:{order:"order",disabled:"disabled",tables:"tables"},outputs:{tableSelect:"tableSelect"},decls:5,vars:3,consts:[["placeholder","Choisir la table",3,"formControl","selectedText","ionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"]],template:function(e,t){1&e&&(a.TgZ(0,"ion-item"),a.TgZ(1,"ion-label"),a._uU(2,"Table"),a.qZA(),a.TgZ(3,"ion-select",0),a.NdJ("ionChange",function(e){return t.tableSelected(e)}),a.YNc(4,p,2,3,"ion-select-option",1),a.qZA(),a.qZA()),2&e&&(a.xp6(3),a.Q6J("formControl",t.tableSelectControl)("selectedText",null==t.selectedTable?null:t.selectedTable.name),a.xp6(1),a.Q6J("ngForOf",t._tables))},directives:[l.Ie,l.Q$,l.t9,l.QI,n.JJ,n.oH,r.sg,l.n0],styles:[""]}),e})();var m=i(90902);let y=(()=>{class e{constructor(e){this.orderService=e,this.qty=0}set order(e){this.updqateQty(e)}ngOnInit(){}incrementOrderDish(e){this.orderService.addDish(e)}decrementOrderDish(e){this.orderService.decrementQtyOfOrderDish(e)}updqateQty(e){const t=this.orderService.findIndexOfDish(this.dish.id,e);this.qty=t>=0?e.dishes[t].qty:0}}return e.\u0275fac=function(t){return new(t||e)(a.Y36(s.px))},e.\u0275cmp=a.Xpm({type:e,selectors:[["mobile-dish"]],inputs:{dish:"dish",order:"order"},decls:14,vars:6,consts:[["slot","end",1,"quantity"],["size","small","color","primary",1,"btn-change-qty",3,"click"],["color","light"]],template:function(e,t){1&e&&(a.TgZ(0,"ion-item"),a.TgZ(1,"ion-label"),a.TgZ(2,"h2"),a._uU(3),a.qZA(),a.TgZ(4,"p"),a._uU(5),a.ALo(6,"currency"),a.qZA(),a.qZA(),a.TgZ(7,"div",0),a.TgZ(8,"ion-button",1),a.NdJ("click",function(){return t.decrementOrderDish(t.dish)}),a._uU(9," - "),a.qZA(),a.TgZ(10,"ion-button",2),a._uU(11),a.qZA(),a.TgZ(12,"ion-button",1),a.NdJ("click",function(){return t.incrementOrderDish(t.dish)}),a._uU(13," + "),a.qZA(),a.qZA(),a.qZA()),2&e&&(a.xp6(3),a.hij(" ",t.dish.name," "),a.xp6(2),a.hij(" ",a.xi3(6,3,t.dish.price,"Ar")," "),a.xp6(6),a.hij(" ",t.qty," "))},directives:[l.Ie,l.Q$,l.YG],pipes:[r.H9],styles:[".btn-change-qty[_ngcontent-%COMP%]{font-weight:700}"]}),e})();function T(e,t){if(1&e&&(a.ynx(0),a._UZ(1,"mobile-dish",1),a.BQk()),2&e){const e=t.$implicit,i=a.oxw();a.xp6(1),a.Q6J("dish",e)("order",i.order)}}let Z=(()=>{class e{constructor(){}set categoryId(e){this.dishesToShow=[...this.menu.dishes].filter(t=>t.categoryId===e)}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=a.Xpm({type:e,selectors:[["mobile-menu"]],inputs:{menu:"menu",categoryId:"categoryId",order:"order"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"dish","order"]],template:function(e,t){1&e&&(a.TgZ(0,"ion-list"),a.YNc(1,T,2,2,"ng-container",0),a.qZA()),2&e&&(a.xp6(1),a.Q6J("ngForOf",t.dishesToShow))},directives:[l.q_,r.sg,y],styles:[""]}),e})();function v(e,t){if(1&e){const e=a.EpF();a.TgZ(0,"ion-fab-button",4),a.NdJ("click",function(){a.CHM(e);const t=a.oxw().ngIf;return a.oxw().validateOrder(t)}),a._UZ(1,"ion-icon",5),a.qZA()}if(2&e){const e=a.oxw().ngIf;a.Q6J("disabled",!(e.dishes.length>0&&e.table))}}function S(e,t){if(1&e){const e=a.EpF();a.TgZ(0,"mobile-table-select",6),a.NdJ("tableSelect",function(t){return a.CHM(e),a.oxw(2).tableSelected(t)}),a.ALo(1,"async"),a.qZA()}if(2&e){const e=a.oxw().ngIf,t=a.oxw();a.Q6J("order",e)("tables",a.lcZ(1,3,t.tables$))("disabled",t.editMode)}}function I(e,t){if(1&e&&a._UZ(0,"hotely-order-table",8),2&e){const e=a.oxw(2).ngIf;a.Q6J("tableId",e.table)}}function O(e,t){if(1&e&&(a.ynx(0),a.TgZ(1,"ion-item"),a.TgZ(2,"ion-label"),a._uU(3," Commande num: "),a.YNc(4,I,1,1,"hotely-order-table",7),a.qZA(),a.qZA(),a.BQk()),2&e){const e=a.oxw().ngIf;a.xp6(4),a.Q6J("ngIf",e.table)}}function A(e,t){if(1&e&&(a.TgZ(0,"ion-segment-button",12),a.TgZ(1,"ion-label"),a._uU(2),a.qZA(),a.qZA()),2&e){const e=t.$implicit;a.Q6J("value",e.id),a.xp6(2),a.Oqu(e.name)}}function x(e,t){if(1&e&&a._UZ(0,"mobile-menu",13),2&e){const e=t.$implicit,i=a.oxw().ngIf,r=a.oxw(2).ngIf,n=a.oxw();a.Q6J("menu",e)("categoryId",n.currentCategoryId||i[0].id)("order",r)}}function q(e,t){if(1&e){const e=a.EpF();a.ynx(0),a.TgZ(1,"ion-segment",9),a.NdJ("ionChange",function(t){return a.CHM(e),a.oxw(3).categoryChanged(t)}),a.YNc(2,A,3,2,"ion-segment-button",10),a.qZA(),a.YNc(3,x,1,3,"mobile-menu",11),a.ALo(4,"async"),a.BQk()}if(2&e){const e=t.ngIf,i=a.oxw(3);a.xp6(1),a.Q6J("value",e[0].id),a.xp6(1),a.Q6J("ngForOf",e),a.xp6(1),a.Q6J("ngForOf",a.lcZ(4,3,i.menus$))}}function C(e,t){if(1&e&&(a.ynx(0),a.YNc(1,q,5,5,"ng-container",1),a.ALo(2,"async"),a.BQk()),2&e){const e=a.oxw(2);a.xp6(1),a.Q6J("ngIf",a.lcZ(2,1,e.categories$))}}function J(e,t){if(1&e&&(a.ynx(0),a.YNc(1,v,2,1,"ion-fab-button",2),a.YNc(2,S,2,5,"mobile-table-select",3),a.YNc(3,O,5,1,"ng-container",1),a.YNc(4,C,3,3,"ng-container",1),a.BQk()),2&e){const e=t.ngIf;a.xp6(1),a.Q6J("ngIf",e.dishes),a.xp6(1),a.Q6J("ngIf","ON_SITE"===e.type),a.xp6(1),a.Q6J("ngIf","TAKE_AWAY"===e.type),a.xp6(1),a.Q6J("ngIf",e.table)}}let Q=(()=>{class e{constructor(e,t,i,r,o,s,l){this.menuService=e,this.orderService=t,this.toastService=i,this.router=r,this.tableService=o,this.categoryService=s,this.route=l,this.tables$=this.tableService.getOnSiteTables(),this.tempTables$=this.tableService.getTempTables().pipe((0,c.U)(e=>e.filter(e=>e.available))),this.order$=this.orderService.orderSubject$,this.categories$=this.categoryService.getCategories(),this.editMode=!1,this.orderTypeControl=new n.NI,this.orderService.removeLocalOrder()}ngOnInit(){this.getMenus(),this.initializeOrder()}ngOnDestroy(){this.categoriesSubscription&&this.categoriesSubscription.unsubscribe(),this.orderSubscription&&this.orderSubscription.unsubscribe(),this.orderTypeSubscription&&this.orderTypeSubscription.unsubscribe()}initializeOrder(){const e=this.route.snapshot.params.orderId;e?(this.setEditMode(!0),this.initializeOrderToEdit(e)):this.initializeNewOrder()}getMenus(){this.menus$=this.menuService.getMenus()}selectOrderType(e){this.orderService.initializeOrder(null,e),this.editMode||e===s.Jm.TAKE_AWAY&&this.useTempTable()}useTempTable(){this.tableService.tempTableAvailable().subscribe(e=>{e?this.tableSelected(e.id):this.tableService.addTempTable().subscribe(e=>{this.tableSelected(e.id)})})}validateOrder(e){this.orderService.validate(e).subscribe(e=>{this.setCurrentTable(null),this.toastService.notify({message:"Commande Valid\xe9e"}),this.orderService.removeLocalOrder(),this.router.navigate(["orders"])})}categoryChanged(e){const{detail:{value:t}}=e;this.currentCategoryId=t}tableSelected(e){this.setCurrentTable(e),this.orderService.updateCurrentOrder({table:e})}initializeNewOrder(e=s.Jm.TAKE_AWAY){this.currentOrderType=e}initializeOrderToEdit(e){this.orderService.getOrderById(e).valueChanges().subscribe(t=>{this.orderService.setCurrentOrder(Object.assign(Object.assign({},t),{id:e}))})}setEditMode(e){this.editMode=e}setCurrentTable(e){this.currentTable=e}}return e.\u0275fac=function(t){return new(t||e)(a.Y36(s.hl),a.Y36(s.px),a.Y36(s.kl),a.Y36(o.F0),a.Y36(s.wm),a.Y36(s.HE),a.Y36(o.gz))},e.\u0275cmp=a.Xpm({type:e,selectors:[["mobile-order"]],decls:5,vars:7,consts:[[3,"order","readOnly","typeSelected"],[4,"ngIf"],["class","validate-button","color","primary",3,"disabled","click",4,"ngIf"],[3,"order","tables","disabled","tableSelect",4,"ngIf"],["color","primary",1,"validate-button",3,"disabled","click"],["name","checkmark-outline"],[3,"order","tables","disabled","tableSelect"],[3,"tableId",4,"ngIf"],[3,"tableId"],["scrollable","",3,"value","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"menu","categoryId","order",4,"ngFor","ngForOf"],[3,"value"],[3,"menu","categoryId","order"]],template:function(e,t){1&e&&(a.TgZ(0,"ion-content"),a.TgZ(1,"mobile-order-type-select",0),a.NdJ("typeSelected",function(e){return t.selectOrderType(e)}),a.ALo(2,"async"),a.qZA(),a.YNc(3,J,5,4,"ng-container",1),a.ALo(4,"async"),a.qZA()),2&e&&(a.xp6(1),a.Q6J("order",a.lcZ(2,3,t.order$))("readOnly",t.editMode),a.xp6(2),a.Q6J("ngIf",a.lcZ(4,5,t.order$)))},directives:[l.W2,g,r.O5,l.W4,l.gu,f,l.Ie,l.Q$,m.C,l.cJ,l.QI,r.sg,l.GO,Z],pipes:[r.Ov],styles:[".validate-button[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px}"]}),e})();const w=[{path:"",children:[{path:"",component:Q},{path:"edit/:orderId",component:Q}]}];let _=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[r.ez,n.u5,n.UX,l.Pc,o.Bz.forChild(w),s.IR]]}),e})()}}]);