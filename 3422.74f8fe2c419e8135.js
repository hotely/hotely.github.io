"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([[3422],{3422:(G,v,n)=>{n.r(v),n.d(v,{OrdersPageModule:()=>V});var m=n(9808),S=n(3075),b=n(9516),o=n(3720),h=n(3950),O=n(655),y=n(3426),x=n(3009),C=n(6688),A=n(3489),f=n(5430),g=n(1177);class P{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new R(e,this.resultSelector))}}class R extends A.L{constructor(e,t,r=Object.create(null)){super(e),this.resultSelector=t,this.iterators=[],this.active=0,this.resultSelector="function"==typeof t?t:void 0}_next(e){const t=this.iterators;(0,C.k)(e)?t.push(new Z(e)):t.push("function"==typeof e[f.hZ]?new I(e[f.hZ]()):new $(this.destination,this,e))}_complete(){const e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(let r=0;r<t;r++){let a=e[r];a.stillUnsubscribed?this.destination.add(a.subscribe()):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const e=this.iterators,t=e.length,r=this.destination;for(let c=0;c<t;c++){let u=e[c];if("function"==typeof u.hasValue&&!u.hasValue())return}let a=!1;const l=[];for(let c=0;c<t;c++){let u=e[c],p=u.next();if(u.hasCompleted()&&(a=!0),p.done)return void r.complete();l.push(p.value)}this.resultSelector?this._tryresultSelector(l):r.next(l),a&&r.complete()}_tryresultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}class I{constructor(e){this.iterator=e,this.nextResult=e.next()}hasValue(){return!0}next(){const e=this.nextResult;return this.nextResult=this.iterator.next(),e}hasCompleted(){const e=this.nextResult;return Boolean(e&&e.done)}}class Z{constructor(e){this.array=e,this.index=0,this.length=0,this.length=e.length}[f.hZ](){return this}next(e){const t=this.index++;return t<this.length?{value:this.array[t],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class $ extends g.Ds{constructor(e,t,r){super(e),this.parent=t,this.observable=r,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[f.hZ](){return this}next(){const e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(e){this.buffer.push(e),this.parent.checkIterators()}subscribe(){return(0,g.ft)(this.observable,new g.IY(this))}}var N=n(7545),B=n(4850),s=n(5e3),D=n(902),d=n(9591);let T=(()=>{class i{constructor(){this.changed=new s.vpe}set status(t){switch(t){case d.q.PENDING:this._status={label:"En attente",color:"primary"};break;case d.q.PREPARING:this._status={label:"En pr\xe9paration",color:"secondary"};break;case d.q.READY:this._status={label:"Pr\xeat",color:"success"};break;case d.q.SERVED:this._status={label:"Servie",color:"medium"};break;case d.q.CANCELED:this._status={label:"Annul\xe9e",color:"danger"};break;case d.q.DONE:this._status={label:"Termin\xe9e",color:"success"};break;default:this._status={label:"En Attente",color:"primary"}}this.changed.emit(this._status)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=s.Xpm({type:i,selectors:[["hotely-order-status"]],inputs:{status:"status"},outputs:{changed:"changed"},decls:2,vars:1,consts:[[1,"order-status"]],template:function(t,r){1&t&&(s.TgZ(0,"span",0),s._uU(1),s.qZA()),2&t&&(s.xp6(1),s.Oqu(r._status.label))},encapsulation:2}),i})();function F(i,e){if(1&i){const t=s.EpF();s.TgZ(0,"ion-item",1),s.NdJ("click",function(){const l=s.CHM(t).$implicit;return s.oxw().selectOrder(l)}),s.TgZ(1,"ion-label"),s._UZ(2,"hotely-order-table",2),s.qZA(),s.TgZ(3,"ion-note",3,4)(5,"hotely-order-status",5),s.NdJ("changed",function(a){return s.CHM(t),s.MAs(4).color=a.color}),s.qZA()()()}if(2&i){const t=e.$implicit;s.xp6(2),s.Q6J("tableId",t.table),s.xp6(3),s.Q6J("status",t.status)}}const M=[{path:"",component:(()=>{class i{constructor(t,r,a,l){this.orderService=t,this.actionSheetController=r,this.router=a,this.toastService=l,this.pendingOrders$=this.orderService.getOrdersByStatus(o.qb.PENDING),this.preparingOrders$=this.orderService.getOrdersByStatus(o.qb.PREPARING),this.readyOrders$=this.orderService.getOrdersByStatus(o.qb.READY),this.servedOrders$=this.orderService.getOrdersByStatus(o.qb.SERVED),this.orders$=(0,y.aj)([this.preparingOrders$,this.pendingOrders$,this.servedOrders$,this.readyOrders$]).pipe((0,N.w)(c=>function E(...i){const e=i[i.length-1];return"function"==typeof e&&i.pop(),(0,x.n)(i,void 0).lift(new P(e))}(this.preparingOrders$,this.pendingOrders$,this.servedOrders$,this.readyOrders$).pipe((0,B.U)(u=>u.reduce((p,Y)=>p.concat(Y),[])))))}ngOnInit(){}selectOrder(t){this.showActions(t)}getActionsButtons(t,r){switch(t){case"edit":return{text:"Modifier",icon:"create-outline",handler:()=>{this.handleEdit(r)}};case"delete":return{text:"Supprimer",role:"destructive",icon:"trash",handler:()=>{this.handleRemove(r)}};case"serve":return{text:"Servir",role:"destructive",icon:"checkmark-done-outline",handler:()=>{this.handleServed(r)}};case"cancel":return{text:"Annuler",role:"destructive",icon:"trash-outline",handler:()=>{this.handleCancel(r)}};case"finish":return{text:"Terminer",role:"destructive",icon:"done",handler:()=>{this.handleFinish(r)}}}}showActions(t){return(0,O.mG)(this,void 0,void 0,function*(){yield(yield this.actionSheetController.create({header:"Actions",buttons:[...(()=>{switch(t.status){case o.qb.PENDING:return[this.getActionsButtons("edit",t),this.getActionsButtons("delete",t),this.getActionsButtons("cancel",t)];case o.qb.READY:return[this.getActionsButtons("serve",t)];case o.qb.SERVED:return[this.getActionsButtons("finish",t)];default:return[]}})(),{text:"Fermer",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]})).present()})}handleEdit(t){this.router.navigate([`order/edit/${t.id}`])}handleRemove(t){this.orderService.removeOrder(t).subscribe(()=>{this.toastService.notify({message:"Commande supprim\xe9e"})})}handleServed(t){this.setOrderStatus(t,o.qb.SERVED)}handleCancel(t){this.setOrderStatus(t,o.qb.CANCELED)}handleFinish(t){this.setOrderStatus(t,o.qb.DONE)}setOrderStatus(t,r){this.orderService.setOrderStatus(t,r).subscribe(()=>{this.toastService.notify({message:"Commande modifi\xe9e"})})}}return i.\u0275fac=function(t){return new(t||i)(s.Y36(o.px),s.Y36(h.BX),s.Y36(b.F0),s.Y36(o.kl))},i.\u0275cmp=s.Xpm({type:i,selectors:[["mobile-orders"]],decls:4,vars:3,consts:[[3,"click",4,"ngFor","ngForOf"],[3,"click"],[3,"tableId"],["slot","end"],["noteStatus",""],[3,"status","changed"]],template:function(t,r){1&t&&(s.TgZ(0,"ion-content")(1,"ion-list"),s.YNc(2,F,6,2,"ion-item",0),s.ALo(3,"async"),s.qZA()()),2&t&&(s.xp6(2),s.Q6J("ngForOf",s.lcZ(3,1,r.orders$)))},directives:[h.W2,h.q_,m.sg,h.Ie,h.Q$,D.C,h.uN,T],pipes:[m.Ov],styles:[""]}),i})()}];let V=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=s.oAB({type:i}),i.\u0275inj=s.cJS({imports:[[m.ez,S.u5,h.Pc,b.Bz.forChild(M),o.IR]]}),i})()}}]);