"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([[4966],{4966:(z,p,s)=>{s.r(p),s.d(p,{OrderPageModule:()=>U});var _=s(9808),c=s(3075),u=s(9516),d=s(3720),i=s(3950),m=s(4850),e=s(5e3);function b(n,o){if(1&n&&(e.TgZ(0,"ion-radio-group",2)(1,"ion-list-header")(2,"ion-label"),e._uU(3,"Type de la commande"),e.qZA()(),e.TgZ(4,"ion-item")(5,"ion-label"),e._uU(6,"\xc0 emporter"),e.qZA(),e._UZ(7,"ion-radio",3),e.qZA(),e.TgZ(8,"ion-item")(9,"ion-label"),e._uU(10,"Sur place"),e.qZA(),e._UZ(11,"ion-radio",4),e.qZA()()),2&n){const t=e.oxw();e.Q6J("value",null==t.order?null:t.order.type)("formControl",t.orderTypeControl)}}function h(n,o){1&n&&(e.TgZ(0,"ion-label"),e._uU(1," Commande sur place "),e.qZA())}function f(n,o){1&n&&(e.TgZ(0,"ion-label"),e._uU(1," Commande \xe0 emporter "),e.qZA())}function T(n,o){if(1&n&&(e.TgZ(0,"ion-item"),e.YNc(1,h,2,0,"ion-label",5),e.YNc(2,f,2,0,"ion-label",5),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf","ON_SITE"===(null==t.order?null:t.order.type)),e.xp6(1),e.Q6J("ngIf","TAKE_AWAY"===(null==t.order?null:t.order.type))}}let y=(()=>{class n{constructor(){this.typeSelected=new e.vpe,this.orderTypeControl=new c.NI,this.orderTypeSubscription=this.orderTypeControl.valueChanges.subscribe(t=>{this.readOnly||this.typeSelected.emit(t)})}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["mobile-order-type-select"]],inputs:{order:"order",readOnly:"readOnly"},outputs:{typeSelected:"typeSelected"},decls:3,vars:2,consts:[[3,"value","formControl",4,"ngIf","ngIfElse"],["readOnlyOrderType",""],[3,"value","formControl"],["slot","start","value","TAKE_AWAY"],["slot","start","value","ON_SITE"],[4,"ngIf"]],template:function(t,r){if(1&t&&(e.YNc(0,b,12,2,"ion-radio-group",0),e.YNc(1,T,3,2,"ng-template",null,1,e.W1O)),2&t){const l=e.MAs(2);e.Q6J("ngIf",!r.readOnly)("ngIfElse",l)}},directives:[_.O5,i.se,i.QI,c.JJ,c.oH,i.yh,i.Q$,i.Ie,i.B7,i.U5],styles:[""]}),n})();function O(n,o){if(1&n&&(e.TgZ(0,"ion-select-option",2),e._uU(1),e.qZA()),2&n){const t=o.$implicit;e.Q6J("value",t.id)("disabled",!t.available),e.xp6(1),e.hij(" ",t.name," ")}}let S=(()=>{class n{constructor(){this.tableSelect=new e.vpe,this.tableSelectControl=new c.NI}set disabled(t){t&&this.tableSelectControl.disable()}set tables(t){t&&(this._tables=t,this.tableSelectControl.setValue(this.order.table),this.selectedTable=t.find(r=>r.id===this.order.table),this.tableSelected({detail:{value:this.order.table}}))}ngOnInit(){}tableSelected(t){this.tableSelect.emit(t.detail.value)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["mobile-table-select"]],inputs:{order:"order",disabled:"disabled",tables:"tables"},outputs:{tableSelect:"tableSelect"},decls:5,vars:3,consts:[["placeholder","Choisir la table",3,"formControl","selectedText","ionChange"],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-item")(1,"ion-label"),e._uU(2,"Table"),e.qZA(),e.TgZ(3,"ion-select",0),e.NdJ("ionChange",function(a){return r.tableSelected(a)}),e.YNc(4,O,2,3,"ion-select-option",1),e.qZA()()),2&t&&(e.xp6(3),e.Q6J("formControl",r.tableSelectControl)("selectedText",null==r.selectedTable?null:r.selectedTable.name),e.xp6(1),e.Q6J("ngForOf",r._tables))},directives:[i.Ie,i.Q$,i.t9,i.QI,c.JJ,c.oH,_.sg,i.n0],styles:[""]}),n})();var v=s(902);let C=(()=>{class n{constructor(t){this.orderService=t,this.qty=0}set order(t){this.updqateQty(t)}ngOnInit(){}incrementOrderDish(t){this.orderService.addDish(t)}decrementOrderDish(t){this.orderService.decrementQtyOfOrderDish(t)}updqateQty(t){const r=this.orderService.findIndexOfDish(this.dish.id,t);this.qty=r>=0?t.dishes[r].qty:0}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.px))},n.\u0275cmp=e.Xpm({type:n,selectors:[["mobile-dish"]],inputs:{dish:"dish",order:"order"},decls:14,vars:6,consts:[["slot","end",1,"quantity"],["size","small","color","primary",1,"btn-change-qty",3,"click"],["color","light"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-item")(1,"ion-label")(2,"h2"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.ALo(6,"currency"),e.qZA()(),e.TgZ(7,"div",0)(8,"ion-button",1),e.NdJ("click",function(){return r.decrementOrderDish(r.dish)}),e._uU(9," - "),e.qZA(),e.TgZ(10,"ion-button",2),e._uU(11),e.qZA(),e.TgZ(12,"ion-button",1),e.NdJ("click",function(){return r.incrementOrderDish(r.dish)}),e._uU(13," + "),e.qZA()()()),2&t&&(e.xp6(3),e.hij(" ",r.dish.name," "),e.xp6(2),e.hij(" ",e.xi3(6,3,r.dish.price,"Ar")," "),e.xp6(6),e.hij(" ",r.qty," "))},directives:[i.Ie,i.Q$,i.YG],pipes:[_.H9],styles:[".btn-change-qty[_ngcontent-%COMP%]{font-weight:700}"]}),n})();function x(n,o){if(1&n&&(e.ynx(0),e._UZ(1,"mobile-dish",1),e.BQk()),2&n){const t=o.$implicit,r=e.oxw();e.xp6(1),e.Q6J("dish",t)("order",r.order)}}let I=(()=>{class n{constructor(){}set categoryId(t){this.dishesToShow=[...this.menu.dishes].filter(r=>r.categoryId===t)}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["mobile-menu"]],inputs:{menu:"menu",categoryId:"categoryId",order:"order"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"dish","order"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-list"),e.YNc(1,x,2,2,"ng-container",0),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngForOf",r.dishesToShow))},directives:[i.q_,_.sg,C],styles:[""]}),n})();function Z(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ion-fab-button",4),e.NdJ("click",function(){e.CHM(t);const l=e.oxw().ngIf;return e.oxw().validateOrder(l)}),e._UZ(1,"ion-icon",5),e.qZA()}if(2&n){const t=e.oxw().ngIf;e.Q6J("disabled",!(t.dishes.length>0&&t.table))}}function A(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"mobile-table-select",6),e.NdJ("tableSelect",function(l){return e.CHM(t),e.oxw(2).tableSelected(l)}),e.ALo(1,"async"),e.qZA()}if(2&n){const t=e.oxw().ngIf,r=e.oxw();e.Q6J("order",t)("tables",e.lcZ(1,3,r.tables$))("disabled",r.editMode)}}function J(n,o){if(1&n&&e._UZ(0,"hotely-order-table",8),2&n){const t=e.oxw(2).ngIf;e.Q6J("tableId",t.table)}}function Q(n,o){if(1&n&&(e.ynx(0),e.TgZ(1,"ion-item")(2,"ion-label"),e._uU(3," Commande num: "),e.YNc(4,J,1,1,"hotely-order-table",7),e.qZA()(),e.BQk()),2&n){const t=e.oxw().ngIf;e.xp6(4),e.Q6J("ngIf",t.table)}}function N(n,o){if(1&n&&(e.TgZ(0,"ion-segment-button",12)(1,"ion-label"),e._uU(2),e.qZA()()),2&n){const t=o.$implicit;e.Q6J("value",t.id),e.xp6(2),e.Oqu(t.name)}}function Y(n,o){if(1&n&&e._UZ(0,"mobile-menu",13),2&n){const t=o.$implicit,r=e.oxw().ngIf,l=e.oxw(2).ngIf,a=e.oxw();e.Q6J("menu",t)("categoryId",a.currentCategoryId||r[0].id)("order",l)}}function q(n,o){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"ion-segment",9),e.NdJ("ionChange",function(l){return e.CHM(t),e.oxw(3).categoryChanged(l)}),e.YNc(2,N,3,2,"ion-segment-button",10),e.qZA(),e.YNc(3,Y,1,3,"mobile-menu",11),e.ALo(4,"async"),e.BQk()}if(2&n){const t=o.ngIf,r=e.oxw(3);e.xp6(1),e.Q6J("value",t[0].id),e.xp6(1),e.Q6J("ngForOf",t),e.xp6(1),e.Q6J("ngForOf",e.lcZ(4,3,r.menus$))}}function w(n,o){if(1&n&&(e.ynx(0),e.YNc(1,q,5,5,"ng-container",1),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.categories$))}}function M(n,o){if(1&n&&(e.ynx(0),e.YNc(1,Z,2,1,"ion-fab-button",2),e.YNc(2,A,2,5,"mobile-table-select",3),e.YNc(3,Q,5,1,"ng-container",1),e.YNc(4,w,3,3,"ng-container",1),e.BQk()),2&n){const t=o.ngIf;e.xp6(1),e.Q6J("ngIf",t.dishes),e.xp6(1),e.Q6J("ngIf","ON_SITE"===t.type),e.xp6(1),e.Q6J("ngIf","TAKE_AWAY"===t.type),e.xp6(1),e.Q6J("ngIf",t.table)}}let g=(()=>{class n{constructor(t,r,l,a,F,E,$){this.menuService=t,this.orderService=r,this.toastService=l,this.router=a,this.tableService=F,this.categoryService=E,this.route=$,this.tables$=this.tableService.getOnSiteTables(),this.tempTables$=this.tableService.getTempTables().pipe((0,m.U)(D=>D.filter(k=>k.available))),this.order$=this.orderService.orderSubject$,this.categories$=this.categoryService.getCategories(),this.editMode=!1,this.orderTypeControl=new c.NI,this.orderService.removeLocalOrder()}ngOnInit(){this.getMenus(),this.initializeOrder()}ngOnDestroy(){this.categoriesSubscription&&this.categoriesSubscription.unsubscribe(),this.orderSubscription&&this.orderSubscription.unsubscribe(),this.orderTypeSubscription&&this.orderTypeSubscription.unsubscribe()}initializeOrder(){const t=this.route.snapshot.params.orderId;t?(this.setEditMode(!0),this.initializeOrderToEdit(t)):this.initializeNewOrder()}getMenus(){this.menus$=this.menuService.getMenus()}selectOrderType(t){this.orderService.initializeOrder(null,t),this.editMode||t===d.Jm.TAKE_AWAY&&this.useTempTable()}useTempTable(){this.tableService.tempTableAvailable().subscribe(t=>{t?this.tableSelected(t.id):this.tableService.addTempTable().subscribe(r=>{this.tableSelected(r.id)})})}validateOrder(t){this.orderService.validate(t).subscribe(r=>{this.setCurrentTable(null),this.toastService.notify({message:"Commande Valid\xe9e"}),this.orderService.removeLocalOrder(),this.router.navigate(["orders"])})}categoryChanged(t){const{detail:{value:r}}=t;this.currentCategoryId=r}tableSelected(t){this.setCurrentTable(t),this.orderService.updateCurrentOrder({table:t})}initializeNewOrder(t=d.Jm.TAKE_AWAY){this.currentOrderType=t}initializeOrderToEdit(t){this.orderService.getOrderById(t).valueChanges().subscribe(r=>{this.orderService.setCurrentOrder(Object.assign(Object.assign({},r),{id:t}))})}setEditMode(t){this.editMode=t}setCurrentTable(t){this.currentTable=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.hl),e.Y36(d.px),e.Y36(d.kl),e.Y36(u.F0),e.Y36(d.wm),e.Y36(d.HE),e.Y36(u.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["mobile-order"]],decls:5,vars:7,consts:[[3,"order","readOnly","typeSelected"],[4,"ngIf"],["class","validate-button","color","primary",3,"disabled","click",4,"ngIf"],[3,"order","tables","disabled","tableSelect",4,"ngIf"],["color","primary",1,"validate-button",3,"disabled","click"],["name","checkmark-outline"],[3,"order","tables","disabled","tableSelect"],[3,"tableId",4,"ngIf"],[3,"tableId"],["scrollable","",3,"value","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"menu","categoryId","order",4,"ngFor","ngForOf"],[3,"value"],[3,"menu","categoryId","order"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-content")(1,"mobile-order-type-select",0),e.NdJ("typeSelected",function(a){return r.selectOrderType(a)}),e.ALo(2,"async"),e.qZA(),e.YNc(3,M,5,4,"ng-container",1),e.ALo(4,"async"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("order",e.lcZ(2,3,r.order$))("readOnly",r.editMode),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,5,r.order$)))},directives:[i.W2,y,_.O5,i.W4,i.gu,S,i.Ie,i.Q$,v.C,i.cJ,i.QI,_.sg,i.GO,I],pipes:[_.Ov],styles:[".validate-button[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px}"]}),n})();const P=[{path:"",children:[{path:"",component:g},{path:"edit/:orderId",component:g}]}];let U=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[_.ez,c.u5,c.UX,i.Pc,u.Bz.forChild(P),d.IR]]}),n})()}}]);